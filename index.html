<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>High-Res Mini Printer Splitter</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
    <style>
        body { font-family: 'ChulaCharasNew', sans-serif; background: #f0f2f5; padding: 20px; text-align: center; }
        .card { background: white; max-width: 500px; margin: auto; padding: 25px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        .upload-box { border: 3px dashed #007bff; padding: 40px; border-radius: 15px; cursor: pointer; transition: 0.3s; margin-bottom: 20px; }
        .upload-box:hover { background: #eef6ff; border-color: #0056b3; }
        .btn-process { background: #007bff; color: white; border: none; padding: 12px 30px; border-radius: 10px; font-size: 16px; font-weight: bold; cursor: pointer; width: 100%; }
        .btn-download { background: #000; color: #fff; border: none; padding: 8px 15px; border-radius: 5px; margin-top: 10px; cursor: pointer; }
        .preview-item { background: #fff; margin-top: 20px; padding: 15px; border-radius: 10px; border: 1px solid #ddd; }
        canvas { width: 100%; height: auto; image-rendering: -webkit-optimize-contrast; image-rendering: crisp-edges; }
        .setting-group { display: flex; align-items: center; justify-content: space-between; margin-bottom: 15px; text-align: left; }
    </style>
</head>
<body>

<div class="card">
    <h2 style="margin-top:0">üñ®Ô∏è ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡πÉ‡∏ö‡∏õ‡∏∞‡∏´‡∏ô‡πâ‡∏≤</h2>
    
    <div class="upload-box" onclick="document.getElementById('fileInput').click()">
        <input type="file" id="fileInput" accept="application/pdf" style="display:none">
        <strong>+ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå PDF</strong>
        <p style="font-size: 12px; color: #888;">‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏à‡∏∞‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏°‡∏ä‡∏±‡∏î‡∏™‡∏π‡∏á‡∏û‡∏¥‡πÄ‡∏®‡∏©</p>
    </div>

    <div class="setting-group">
        <label>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏´‡∏±‡πà‡∏ô:</label>
        <input type="number" id="splitCount" value="2" min="1" style="width: 50px; padding: 5px;">
    </div>

    <button class="btn-process" onclick="processPDF()">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏±‡∏î‡∏™‡∏π‡∏á</button>

    <div id="previewContainer"></div>
</div>

<script>
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.worker.min.js';

    async function processPDF() {
        const fileInput = document.getElementById('fileInput');
        const splitCount = parseInt(document.getElementById('splitCount').value);
        const container = document.getElementById('previewContainer');

        if (!fileInput.files[0]) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå PDF ‡∏Ñ‡∏£‡∏±‡∏ö");

        container.innerHTML = "<p>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏£‡∏ô‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏†‡∏≤‡∏û‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏™‡∏π‡∏á...</p>";

        const file = fileInput.files[0];
        const arrayBuffer = await file.arrayBuffer();
        
        // ‡πÇ‡∏´‡∏•‡∏î PDF
        const pdf = await pdfjsLib.getDocument({data: arrayBuffer}).promise;
        const page = await pdf.getPage(1);

        // *** ‡∏à‡∏∏‡∏î‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç: ‡πÄ‡∏û‡∏¥‡πà‡∏° Scale ‡πÄ‡∏õ‡πá‡∏ô 5 ‡πÄ‡∏ó‡πà‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏Ñ‡∏°‡∏Å‡∏£‡∏¥‡∏ö ***
        const scale = 5.0; 
        const viewport = page.getViewport({ scale: scale });
        
        const canvas = document.createElement('canvas');
        const context = canvas.getContext('2d', { alpha: false });
        canvas.width = viewport.width;
        canvas.height = viewport.height;

        // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÉ‡∏´‡πâ‡∏†‡∏≤‡∏û‡∏ä‡∏±‡∏î‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î
        context.imageSmoothingEnabled = true;
        context.imageSmoothingQuality = 'high';

        await page.render({ 
            canvasContext: context, 
            viewport: viewport,
            intent: 'print' // ‡πÉ‡∏ä‡πâ‡πÇ‡∏´‡∏°‡∏î‡∏õ‡∏£‡∏¥‡πâ‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏ï‡∏±‡∏ß‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡πÄ‡∏Ç‡πâ‡∏°‡∏Ç‡∏∂‡πâ‡∏ô
        }).promise;

        container.innerHTML = "";

        const partHeight = canvas.height / splitCount;

        for (let i = 0; i < splitCount; i++) {
            const partCanvas = document.createElement('canvas');
            const partCtx = partCanvas.getContext('2d');
            
            partCanvas.width = canvas.width;
            partCanvas.height = partHeight;

            // ‡∏ß‡∏≤‡∏î‡∏™‡πà‡∏ß‡∏ô‡πÅ‡∏ö‡πà‡∏á
            partCtx.drawImage(
                canvas, 
                0, i * partHeight, canvas.width, partHeight, 
                0, 0, canvas.width, partHeight
            );

            const wrapper = document.createElement('div');
            wrapper.className = "preview-item";
            
            const title = document.createElement('div');
            title.innerHTML = `<strong>‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà ${i+1}</strong> (Resolution: ${partCanvas.width}x${Math.round(partCanvas.height)})`;
            title.style.fontSize = "12px";
            title.style.marginBottom = "10px";

            const downloadBtn = document.createElement('button');
            downloadBtn.innerText = "‚¨áÔ∏è ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏†‡∏≤‡∏û‡∏ä‡∏±‡∏î‡∏û‡∏¥‡πÄ‡∏®‡∏©";
            downloadBtn.className = "btn-download";
            downloadBtn.onclick = () => {
                const link = document.createElement('a');
                link.download = `clear-label-part-${i+1}.png`;
                link.href = partCanvas.toDataURL('image/png', 1.0); // ‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û 100%
                link.click();
            };

            wrapper.appendChild(title);
            wrapper.appendChild(partCanvas);
            wrapper.appendChild(downloadBtn);
            container.appendChild(wrapper);
        }
    }
</script>

</body>
</html>
