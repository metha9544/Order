<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mini Printer Resizer (57mm)</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
    <style>
        body { font-family: sans-serif; max-width: 600px; margin: 20px auto; padding: 20px; background: #fafafa; text-align: center; }
        .container { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .upload-area { border: 2px dashed #007bff; padding: 30px; margin-bottom: 20px; border-radius: 8px; cursor: pointer; background: #f0f7ff; }
        .controls { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px; text-align: left; }
        input, button { width: 100%; padding: 10px; box-sizing: border-box; border-radius: 5px; border: 1px solid #ddd; }
        button { background: #007bff; color: white; border: none; cursor: pointer; font-weight: bold; }
        button:hover { background: #0056b3; }
        #previewContainer { margin-top: 20px; background: #eee; padding: 10px; border-radius: 8px; }
        canvas { display: block; margin: 10px auto; border: 1px solid #333; width: 200px; /* ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡πÉ‡∏´‡πâ‡∏î‡∏π‡∏á‡πà‡∏≤‡∏¢ */ height: auto; background: white; }
        .download-btn { background: #28a745; margin-top: 5px; margin-bottom: 15px; }
    </style>
</head>
<body>

<div class="container">
    <h3>üìè Fixed 57mm Splitter</h3>
    <p style="font-size: 0.9em; color: #666;">‡∏•‡πá‡∏≠‡∏Ñ‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Samugiken / Peripage</p>

    <div class="upload-area" onclick="document.getElementById('fileInput').click()">
        <input type="file" id="fileInput" accept="application/pdf" style="display:none">
        ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå PDF
    </div>

    <div class="controls">
        <div>
            <label>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÅ‡∏ö‡πà‡∏á:</label>
            <input type="number" id="splitCount" value="2" min="1">
        </div>
        <div>
            <label>&nbsp;</label>
            <button onclick="processPDF()">‡∏ï‡∏±‡∏î‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏•‡∏¢!</button>
        </div>
    </div>

    <div id="previewContainer">
        </div>
</div>

<script>
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.worker.min.js';

    async function processPDF() {
        const fileInput = document.getElementById('fileInput');
        const splitCount = parseInt(document.getElementById('splitCount').value);
        const container = document.getElementById('previewContainer');
        const targetWidth = 384; // ‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô‡∏à‡∏∏‡∏î‡∏û‡∏¥‡∏Å‡πÄ‡∏ã‡∏•‡∏Ç‡∏≠‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏ß‡πâ‡∏≤‡∏á 57mm

        if (!fileInput.files[0]) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏Å‡πà‡∏≠‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö");
        
        container.innerHTML = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Ç‡∏ô‡∏≤‡∏î‡∏†‡∏≤‡∏û...";
        
        const file = fileInput.files[0];
        const arrayBuffer = await file.arrayBuffer();
        const pdf = await pdfjsLib.getDocument(arrayBuffer).promise;
        const page = await pdf.getPage(1);

        // ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 1: Render PDF ‡∏≠‡∏≠‡∏Å‡∏°‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏†‡∏≤‡∏û‡∏Ç‡∏ô‡∏≤‡∏î‡πÉ‡∏´‡∏ç‡πà‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏ä‡∏±‡∏î
        const initialViewport = page.getViewport({ scale: 3.0 });
        const tempCanvas = document.createElement('canvas');
        const tempCtx = tempCanvas.getContext('2d');
        tempCanvas.width = initialViewport.width;
        tempCanvas.height = initialViewport.height;
        await page.render({ canvasContext: tempCtx, viewport: initialViewport }).promise;

        // ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 2: ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡πÉ‡∏´‡∏°‡πà‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏•‡πá‡∏≠‡∏Ñ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡∏ó‡∏µ‡πà 384px
        const scaleFactor = targetWidth / tempCanvas.width;
        const totalTargetHeight = tempCanvas.height * scaleFactor;
        const partHeight = totalTargetHeight / splitCount;

        container.innerHTML = ""; // ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠

        // ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 3: ‡∏´‡∏±‡πà‡∏ô‡πÅ‡∏•‡∏∞ Resize ‡∏•‡∏á Canvas ‡πÉ‡∏´‡∏°‡πà
        for (let i = 0; i < splitCount; i++) {
            const finalCanvas = document.createElement('canvas');
            const finalCtx = finalCanvas.getContext('2d');
            
            finalCanvas.width = targetWidth;
            finalCanvas.height = partHeight;

            // ‡∏ß‡∏≤‡∏î‡πÇ‡∏î‡∏¢‡∏Å‡∏≤‡∏£‡∏¢‡πà‡∏≠‡∏Ç‡∏ô‡∏≤‡∏î (Resize) ‡πÅ‡∏•‡∏∞‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏™‡πà‡∏ß‡∏ô (Crop)
            finalCtx.drawImage(
                tempCanvas, 
                0, (i * (tempCanvas.height / splitCount)), tempCanvas.width, (tempCanvas.height / splitCount), // Source
                0, 0, targetWidth, partHeight // Destination
            );

            // ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•
            const wrapper = document.createElement('div');
            const label = document.createElement('p');
            label.innerText = `‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà ${i + 1} (‡∏Å‡∏ß‡πâ‡∏≤‡∏á 57mm)`;
            label.style.fontSize = "12px";
            
            const btn = document.createElement('button');
            btn.innerText = `‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏ó‡∏µ‡πà ${i + 1}`;
            btn.className = "download-btn";
            btn.onclick = () => {
                const link = document.createElement('a');
                link.download = `57mm-part-${i + 1}.png`;
                link.href = finalCanvas.toDataURL('image/png');
                link.click();
            };

            wrapper.appendChild(label);
            wrapper.appendChild(finalCanvas);
            wrapper.appendChild(btn);
            container.appendChild(wrapper);
        }
    }
</script>

</body>
</html>
