<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mini Printer Long Strip Maker</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
    <style>
        body { font-family: sans-serif; background: #f4f4f9; padding: 20px; text-align: center; color: #333; }
        .card { background: white; max-width: 600px; margin: auto; padding: 25px; border-radius: 15px; box-shadow: 0 8px 20px rgba(0,0,0,0.1); }
        .upload-area { border: 3px dashed #4A90E2; padding: 30px; border-radius: 10px; cursor: pointer; margin-bottom: 20px; background: #f9fcff; }
        .upload-area:hover { background: #eef6ff; }
        .controls { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; background: #eee; padding: 15px; border-radius: 10px; }
        .btn-main { background: #4A90E2; color: white; border: none; padding: 12px 25px; border-radius: 8px; font-weight: bold; cursor: pointer; width: 100%; font-size: 16px; }
        .btn-main:hover { background: #357ABD; }
        #previewContainer { margin-top: 20px; overflow-x: auto; white-space: nowrap; background: #333; padding: 20px; border-radius: 10px; display: none; }
        canvas { box-shadow: 0 0 10px rgba(0,0,0,0.5); background: white; max-height: 400px; }
        .info { font-size: 12px; color: #666; margin-top: 10px; }
    </style>
</head>
<body>

<div class="card">
    <h2>üìè ‡∏ï‡∏±‡∏ß‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå‡∏õ‡∏£‡∏¥‡πâ‡∏ô‡πÉ‡∏ö‡∏õ‡∏∞‡∏´‡∏ô‡πâ‡∏≤ (‡πÅ‡∏ö‡∏ö‡∏¢‡∏≤‡∏ß)</h2>
    <p>‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á 57mm</p>
    
    <div class="upload-area" onclick="document.getElementById('fileInput').click()">
        <input type="file" id="fileInput" accept="application/pdf" style="display:none">
        <strong>üìÅ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå PDF ‡πÉ‡∏ö‡∏õ‡∏∞‡∏´‡∏ô‡πâ‡∏≤</strong>
        <p class="info">‡∏†‡∏≤‡∏û‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏´‡∏°‡∏∏‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏ô‡∏ß‡∏ô‡∏≠‡∏ô‡πÉ‡∏´‡πâ‡πÇ‡∏î‡∏¢‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</p>
    </div>

    <div class="controls">
        <span>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏´‡∏±‡πà‡∏ô‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ô:</span>
        <input type="number" id="splitCount" value="2" min="1" max="10" style="padding: 8px; width: 60px; border-radius: 5px; border: 1px solid #ccc;">
    </div>

    <button class="btn-main" onclick="processAndMerge()">‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏•‡∏∞‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏†‡∏≤‡∏û‡πÄ‡∏î‡∏µ‡∏¢‡∏ß</button>

    <div id="previewContainer" id="resultArea">
        <p style="color:white">‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÑ‡∏î‡πâ (‡∏†‡∏≤‡∏û‡∏¢‡∏≤‡∏ß):</p>
        <div id="canvasWrapper"></div>
    </div>
</div>

<script>
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.worker.min.js';

    async function processAndMerge() {
        const fileInput = document.getElementById('fileInput');
        const splitCount = parseInt(document.getElementById('splitCount').value);
        const wrapper = document.getElementById('canvasWrapper');
        const preview = document.getElementById('previewContainer');

        if (!fileInput.files[0]) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏Å‡πà‡∏≠‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö");

        // 1. Load PDF
        const file = fileInput.files[0];
        const arrayBuffer = await file.arrayBuffer();
        const pdf = await pdfjsLib.getDocument({data: arrayBuffer}).promise;
        const page = await pdf.getPage(1);

        // 2. Render PDF High Res
        const scale = 4.0; 
        const viewport = page.getViewport({ scale: scale });
        const tempCanvas = document.createElement('canvas');
        const tempCtx = tempCanvas.getContext('2d');
        tempCanvas.width = viewport.width;
        tempCanvas.height = viewport.height;
        await page.render({ canvasContext: tempCtx, viewport: viewport }).promise;

        // 3. ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏° Canvas ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏†‡∏≤‡∏û‡∏¢‡∏≤‡∏ß (‡∏´‡∏±‡πà‡∏ô‡πÅ‡∏ô‡∏ß‡∏ï‡∏±‡πâ‡∏á‡∏Ç‡∏≠‡∏á‡∏ï‡πâ‡∏ô‡∏â‡∏ö‡∏±‡∏ö ‡∏°‡∏≤‡∏ß‡∏≤‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏ô‡∏ß‡∏ô‡∏≠‡∏ô)
        // ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡∏´‡∏°‡∏∏‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏© PDF ‡∏à‡∏≤‡∏Å‡πÅ‡∏ô‡∏ß‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏ô‡∏ß‡∏ô‡∏≠‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏õ‡∏£‡∏¥‡πâ‡∏ô‡∏≠‡∏≠‡∏Å‡∏°‡∏≤‡πÉ‡∏´‡∏ç‡πà
        const partWidth = tempCanvas.width;
        const partHeight = tempCanvas.height / splitCount;

        const finalCanvas = document.createElement('canvas');
        const finalCtx = finalCanvas.getContext('2d');

        // ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà = ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡∏Ç‡∏≠‡∏á‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏´‡∏±‡πà‡∏ô‡∏°‡∏≤‡∏ß‡∏≤‡∏á‡∏ô‡∏≠‡∏ô
        // ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß‡πÉ‡∏´‡∏°‡πà = ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡∏Ç‡∏≠‡∏á‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏´‡∏±‡πà‡∏ô * ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡πà‡∏ß‡∏ô
        finalCanvas.width = partHeight * splitCount; 
        finalCanvas.height = partWidth; 

        for (let i = 0; i < splitCount; i++) {
            // ‡∏™‡∏£‡πâ‡∏≤‡∏á Canvas ‡∏¢‡πà‡∏≠‡∏¢‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏∂‡∏á‡∏†‡∏≤‡∏û‡∏°‡∏≤‡∏´‡∏°‡∏∏‡∏ô
            const pCanvas = document.createElement('canvas');
            const pCtx = pCanvas.getContext('2d');
            pCanvas.width = partHeight;
            pCanvas.height = partWidth;

            // ‡∏¢‡πâ‡∏≤‡∏¢‡∏à‡∏∏‡∏î‡∏´‡∏°‡∏∏‡∏ô‡πÑ‡∏õ‡∏ï‡∏£‡∏á‡∏Å‡∏•‡∏≤‡∏á
            pCtx.translate(pCanvas.width / 2, pCanvas.height / 2);
            pCtx.rotate(90 * Math.PI / 180); // ‡∏´‡∏°‡∏∏‡∏ô 90 ‡∏≠‡∏á‡∏®‡∏≤

            // ‡∏ß‡∏≤‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏´‡∏±‡πà‡∏ô‡∏•‡∏á‡πÑ‡∏õ
            pCtx.drawImage(
                tempCanvas,
                0, i * partHeight, partWidth, partHeight, // Source (‡∏´‡∏±‡πà‡∏ô‡πÅ‡∏ô‡∏ß‡∏ï‡∏±‡πâ‡∏á)
                -partWidth / 2, -partHeight / 2, partWidth, partHeight // Destination
            );

            // ‡πÄ‡∏≠‡∏≤‡πÑ‡∏õ‡πÅ‡∏õ‡∏∞‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ô‡πÉ‡∏ô Final Canvas (‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡πÅ‡∏ô‡∏ß‡∏ô‡∏≠‡∏ô)
            finalCtx.drawImage(pCanvas, i * partHeight, 0);
        }

        // 4. ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÅ‡∏•‡∏∞‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î
        wrapper.innerHTML = "";
        wrapper.appendChild(finalCanvas);
        preview.style.display = "block";

        const link = document.createElement('a');
        link.download = `ready-to-print-57mm.png`;
        link.href = finalCanvas.toDataURL('image/png');
        link.click();
    }
</script>

</body>
</html>
